<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <style>
        .main-content {
            max-width: 1100px;
            margin: 0 auto;
            padding: 10px 20px;
        }

        @media (max-width: 576px) {
            .main-content {
                padding: 15px 10px;
            }
        }

        .table-responsive {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        th, td {
            white-space: nowrap;
            vertical-align: middle !important;
        }

        .action-btn {
            width: 100%;
        }
    </style>


    <div class="main-content">

        <!-- GLOBAL MESSAGE AREA (AUTO-REFRESHES) -->
        <h:panelGroup id="msgArea">
            <ui:fragment rendered="#{not empty customerBillingBean.message}">
                <div class="alert alert-#{customerBillingBean.messageType} alert-dismissible fade show">
                    <strong>
                        <ui:fragment rendered="#{customerBillingBean.messageType eq 'success'}">
                            Success:
                        </ui:fragment>
                        <ui:fragment rendered="#{customerBillingBean.messageType ne 'success'}">
                            Error:
                        </ui:fragment>
                    </strong>
                    #{customerBillingBean.message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            </ui:fragment>
        </h:panelGroup>


        <div class="card shadow-sm mt-2">
            <div class="card-body">

                <div class="table-responsive">

                    <!-- TABLE WRAPPED FOR AJAX REFRESH -->
                    <h:panelGroup id="unpaidTable">

                        <table class="table table-hover table-bordered align-middle">

                            <thead class="table-dark">
                                <tr>
                                    <th>Service Name</th>
                                    <th>Amount (KES)</th>
                                    <th>Billing Date</th>
                                    <th style="width:150px;">Action</th>
                                </tr>
                            </thead>

                            <tbody>

                                <!-- LIST NOT EMPTY -->
                                <ui:fragment rendered="#{not empty customerBillingBean.unpaidList}">
                                    <ui:repeat var="bill" value="#{customerBillingBean.unpaidList}">
                                        <tr>
                                            <td>#{bill.serviceName}</td>
                                            <td>#{bill.amount}</td>

                                            <td>
                                                <h:outputText value="#{bill.billingDate}">
                                                    <f:convertDateTime pattern="yyyy-MM-dd HH:mm" />
                                                </h:outputText>
                                            </td>

                                            <td class="text-center">
                                                <h:form id="payForm">

                                                    <h:commandButton
                                                        value="Pay Now"
                                                        styleClass="btn btn-sm btn-success action-btn"
                                                        onclick="return confirm('Mark this bill as PAID?');"
                                                        action="#{customerBillingBean.markBillPaid(bill.id)}">

                                                        <!-- AJAX REFRESHES MESSAGE + TABLE -->
                                                        <f:ajax render="msgArea unpaidTable" />
                                                    </h:commandButton>

                                                </h:form>
                                            </td>
                                        </tr>
                                    </ui:repeat>
                                </ui:fragment>

                                <!-- EMPTY LIST -->
                                <ui:fragment rendered="#{empty customerBillingBean.unpaidList}">
                                    <tr>
                                        <td colspan="4" class="text-center text-muted py-3">
                                            No unpaid bills found.
                                        </td>
                                    </tr>
                                </ui:fragment>

                            </tbody>

                        </table>

                    </h:panelGroup>

                </div>

            </div>
        </div>

    </div>

</ui:composition>
