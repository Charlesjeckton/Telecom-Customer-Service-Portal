<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <h:head>
        <title>Reports &amp; Charts - Admin Panel</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <style>
            /* PAGE CONTAINER — SAME STYLE AS OTHER PAGES */
            .content-wrapper {
                padding: 30px 20px;
                margin-left: 260px; /* space for sidebar */
                transition: margin-left .3s ease;
            }

            /* WHEN SIDEBAR IS COLLAPSED (YOUR SIDEBAR USES .sidebar-collapsed) */
            .sidebar-collapsed + .content-wrapper {
                margin-left: 80px !important;
            }

            /* SMALL SCREENS — SIDEBAR TAKES FULL WIDTH, CONTENT GOES FULL WIDTH */
            @media (max-width: 768px) {
                .content-wrapper {
                    margin-left: 0 !important;
                    padding: 20px 12px;
                }
            }

            /* SECTION TITLE */
            h2.page-title {
                font-weight: 700;
                margin-bottom: 25px;
                text-align: center;
                color: #343a40;
            }

            /* WHITE SMART CARD */
            .smart-card {
                background: #ffffff;
                border-radius: 16px;
                padding: 25px 22px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.10);
                margin-bottom: 30px;
            }

            /* SUMMARY CARD */
            .summary-card {
                background: #ffffff;
                border-radius: 16px;
                padding: 20px;
                text-align: center;
                box-shadow: 0 8px 22px rgba(0,0,0,0.08);
                transition: transform 0.2s ease;
            }

            .summary-card:hover {
                transform: translateY(-3px);
            }

            .summary-title {
                font-size: 16px;
                color: #6c757d;
                font-weight: 600;
                margin-bottom: 8px;
            }

            .summary-value {
                font-size: 32px;
                font-weight: 700;
            }

            /* CHART CARD */
            .chart-card {
                background: #ffffff;
                border-radius: 16px;
                padding: 25px 22px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.10);
                margin-bottom: 32px;
            }

            .chart-title {
                font-weight: 700;
                margin-bottom: 18px;
                text-align: center;
            }

            .chart-wrapper {
                max-width: 750px;
                margin: 0 auto;
            }

            @media (max-width: 768px) {
                .chart-wrapper {
                    max-width: 100%;
                }
            }

            canvas {
                max-height: 360px !important;
            }
            @media (max-width: 380px) {
                h2.text-center {
                    font-size: 20px;
                    margin-top: 50px;
                }
            }

        </style>

    </h:head>

    <h:body>

        <ui:include src="includes/adminTheme.xhtml"/>
        <ui:include src="includes/adminSidebar.xhtml"/>

        <div class="content">

            <h2 class="fw-bold mb-4 text-center">Reports &amp; Billing Analytics</h2>

            <!-- SUMMARY CARDS -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="chart-card text-center">
                        <h5>Total Bills</h5>
                        <h2 class="text-primary">#{adminReportsBean.totalBills}</h2>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="chart-card text-center">
                        <h5>Paid Bills</h5>
                        <h2 class="text-success">#{adminReportsBean.paidCount}</h2>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="chart-card text-center">
                        <h5>Unpaid Bills</h5>
                        <h2 class="text-danger">#{adminReportsBean.unpaidCount}</h2>
                    </div>
                </div>
            </div>

            <!-- PIE CHART -->
            <div class="chart-card">
                <h4 class="chart-title">Paid vs Unpaid Bills</h4>
                <div class="chart-wrapper">
                    <canvas id="pieChart"></canvas>
                </div>
            </div>

            <!-- LINE CHART -->
            <div class="chart-card">
                <h4 class="chart-title">Monthly Billing Trend</h4>
                <div class="chart-wrapper">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>

            <!-- BAR CHART -->
            <div class="chart-card">
                <h4 class="chart-title">Monthly Revenue Comparison</h4>
                <div class="chart-wrapper">
                    <canvas id="barChart"></canvas>
                </div>
            </div>

        </div>

        <script>
            // PIE CHART
            new Chart(document.getElementById('pieChart'), {
                type: 'pie',
                data: {
                    labels: ['Paid', 'Unpaid'],
                    datasets: [{
                            data: [#{adminReportsBean.paidCount}, #{adminReportsBean.unpaidCount}],
                            backgroundColor: ['#28a745', '#dc3545']
                        }]
                }
            });

            // LINE CHART
            new Chart(document.getElementById('lineChart'), {
                type: 'line',
                data: {
                    labels: #{adminReportsBean.monthLabels},
                    datasets: [{
                            label: 'Total Billing (KES)',
                            data: #{adminReportsBean.monthValues},
                            borderWidth: 3,
                            borderColor: '#007bff',
                            tension: 0.3
                        }]
                }
            });

            // BAR CHART (NEW)
            new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: {
                    labels: #{adminReportsBean.monthLabels},
                    datasets: [{
                            label: 'Revenue (KES)',
                            data: #{adminReportsBean.monthValues},
                            borderWidth: 1
                        }]
                }
            });
        </script>
    </h:body>
</ui:composition>
